<?php
declare( strict_types = 1 );
abstract class AbstractFileUpload {
    abstract function validate( FileProperties $fileProperties ): ValidatorResponse;

    function upload() {
        if ( isset( $_FILES['file'] ) ) {
            $file_name = $_FILES['file']['name'];
            $file_size = $_FILES['file']['size'];
            $file_tmp = $_FILES['file']['tmp_name'];
            $file_type = $_FILES['file']['type'];
            $file_properties = new FileProperties( $file_name, $file_size, $file_type );
            $validatorResponse = $this->validate( $file_properties );
            $file_destination = $_SERVER['DOCUMENT_ROOT'].'/VulnerableApp-php/images/'.$file_name;
            if ( $validatorResponse->is_valid() ) {
                move_uploaded_file( $file_tmp, $file_destination );
                echo json_encode( new GenericResponse( true, $file_destination, ""));
            } else {
                echo json_encode( new GenericResponse( false, "", json_encode($validatorResponse->get_error())));
            }
        } else {
            echo json_encode( new GenericResponse( false, "", "Invalid File")); 
        }
    }
}
?>